<!DOCTYPE html>
<html>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script type="text/javascript">

    function changeFocus(e){
        if (e.keyCode==13){
            document.getElementById('PASS').focus();
        }
    }

    function onEnter(e){
        if (e.keyCode==13){
            validar();
        }
    }

    function validar (){
		let nome = document.getElementById('USUARIO').value;
		let senha = document.getElementById('PASS').value;
        let payload = JSON.stringify({ USUARIO : nome, PASS : senha });
        let xhr = new XMLHttpRequest();

        let loadingElement = document.querySelector(".cssload-loader");
        loadingElement.style.display = "block";

        xhr.open("POST", "valida_dados.php", true);
        xhr.setRequestHeader("Content-Type", "application/json");

        ////Obs: após xhr.send ele volta para este ponto
        xhr.onreadystatechange = function(p){
            if ( xhr.readyState === 4 && xhr.status === 200 ){
                //console.log(xhr.responseText);
                data = JSON.parse(xhr.responseText);
                if (data.success==true){
                    var http = new XMLHttpRequest();
                    let params = ("user="+data.user+"&name="+data.user_name);
                    http.open("POST", "billcontol1.php", true);
                    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                    http.send(params);
                }
                else {
                    document.getElementById('resposta').innerHTML=(
                        "Falha ao logar | Usuário e/ou senha incorretos"
                    );
                }
            }
            if ( xhr.readyState === 4 ) loadingElement.style.display = "none";
        };
        xhr.send(payload);
	}

    /*
    * $.post( "valida_dados.php",{ USUARIO : nome, PASS : senha })
     .done(function(result) {
     data = JSON.parse(result);
     if(data.success){
     return document.getElementById("response").innerHTML = (
     document.getElementById('entrar').submit());
     }
     return document.getElementById("response").innerHTML = (
     "Falha: Usuário ou Senha inválidos");
     })
     .fail(function(result) {
     document.getElementById("response").innerHTML = "Erro no Servi?o";
     });
    * */
</script>
<head>
	<title>Controle de Contas</title>
    <link rel="stylesheet" type="text/css" href="regra-formatacao.css" />
</head>
<body>
  <div class="cssload-loader" style="display: none">
    <div class="cssload-inner cssload-one"></div>
    <div class="cssload-inner cssload-two"></div>
    <div class="cssload-inner cssload-three"></div>
  </div>
  <div id="caixa">
      <div id="resposta">&nbsp;</div>
      <p>Usuario:<input type="text" name="USUARIO" id="USUARIO" value="" onkeyup="changeFocus(event)"></p><br>
      <p>Senha:<input type="password" name="PASS" id="PASS" value="" onkeypress="javascript:onEnter(event)"></p><br>
      <p><button onclick="validar()">Validar</button></p>
  </div>
</body>
</html>
